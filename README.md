# Prompt 管理工具

这是一个用于管理 Stable Diffusion / 图片项目的前端 + 后端小工具。它支持：

- **项目管理**：按项目分类管理图片。
- **图片上传与展示**：支持批量上传和响应式画廊布局。
- **Prompt 管理**：为每张图片记录和编辑 Prompt。
- **分组功能**：将图片组织到“分组”（类似分页），并为每个分组添加详细说明。
- **双重移动方式**：支持拖拽或通过菜单将图片移动到不同分组。
- **剧本导入**：从包含“第X页”标记的 `.txt` 文件批量创建或更新分组。
- **PNG 元数据提取**：自动读取并填充 PNG 图片中的 Prompt 信息。
- **实时同步**：通过 WebSocket 支持多窗口或多客户端协作。

## � 快速开始

#### 1. 安装依赖

在项目根目录打开 PowerShell 并运行：

```powershell
npm install
```

#### 2. 启动开发环境

```powershell
npm start
```

此命令会同时启动：
- **后端服务**：默认运行在 `http://localhost:3001`，处理文件操作和数据同步。
- **前端应用**：默认运行在 `http://localhost:5173`（如果端口被占用，会自动尝试其他端口）。

## 📖 功能指南

### 项目管理
- **创建项目**：在主页点击“创建新项目”，选择一个本地文件夹作为项目存储位置。
- **浏览项目**：主页会展示所有已创建的项目卡片。

### 图片与 Prompt 管理
- **上传图片**：进入项目后，点击“上传图片”或直接将图片文件拖拽到页面。也支持通过 `Ctrl+V` 粘贴图片。
- **编辑 Prompt**：在图片下方的文本框中输入或修改 Prompt，内容会自动保存。
- **复制 Prompt**：点击“复制”按钮快速获取 Prompt 内容。

### 分组与剧本
- **创建分组**：点击“创建分组”手动添加新页面。
- **编辑分组**：双击分组的标题或描述区域即可进入编辑模式。
- **移动图片到分组**：
  - **拖拽**：直接将图片卡片拖动到目标分组区域（拖动时会有紫色高亮提示）。
  - **菜单**：点击图片左上角的“⋯”菜单，选择“移动到分组”，然后在弹出的对话框中选择目标分组。
- **导入剧本**：点击页面顶部的“导入剧本”按钮，上传一个 `.txt` 文件。系统会自动解析文件中的“第一页”、“第2页”等标记，并将对应内容作为分组的描述。如果分组已存在，则更新描述；如果不存在，则创建新分组。

## 🛠️ 开发者说明

### 项目结构
- `server/`：后端 Express 服务。
  - `routes/`: API 路由，如 `groups.js` 处理分组相关的逻辑。
- `src/`: 前端 React 应用。
  - `components/`: 可复用的 UI 组件，如 `ImageCard.jsx`, `ImageGroup.jsx`。
  - `contexts/`: 全局状态管理，`ProjectContext.jsx` 是核心。
  - `pages/`: 页面级组件，如 `PromptManagerPage.jsx`。
  - `utils/`: 工具函数，如 `textParser.js` 用于解析剧本文件。

### 数据流与一致性
- **单一数据源**：所有项目数据（图片、Prompt、分组信息）都存储在本地文件系统中。
- **后端逻辑**：服务器负责所有文件读写操作，并确保数据一致性（例如，移动图片时会从原分组中移除）。
- **前端状态**- **实时同步**：后端通过 WebSocket 将文件系统变动实时推送给所有连接的前端客户端，确保多窗口数据同步。

## � 提交说明

本次更新主要包含：
- **功能**：实现了剧本导入逻辑的标准化，确保“第一页”和“第1页”等不同格式都能正确匹配和更新。
- **UI**：将“导入文本”按钮重命名为“导入剧本”，使其含义更清晰。
- **文档**：更新此 `README.md` 文件，使其内容更准确、更具可读性。

